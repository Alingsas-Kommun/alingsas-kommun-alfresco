<?xml version='1.0' encoding='UTF-8'?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

	<!-- Migration -->
	<bean id="se.alingsas.alfresco.repo.scripts.ddmigration.migrationUtil"
		class="se.alingsas.alfresco.repo.scripts.ddmigration.MigrationUtil">
		<property name="fileFolderService" ref="FileFolderService" />
		<property name="siteService" ref="SiteService" />
		<property name="nodeService" ref="NodeService" />
		<property name="checkOutCheckInService" ref="CheckOutCheckInService" />
		<property name="versionService" ref="VersionService" />
		<property name="contentService" ref="ContentService" />
		<property name="searchService" ref="SearchService" />
		<property name="behaviourFilter" ref="policyBehaviourFilter" />
		<property name="serviceRegistry" ref="ServiceRegistry" />
	</bean>

	<bean id="se.alingsas.alfresco.repo.scripts.userhome.userHomesLinkingUtil"
		class="se.alingsas.alfresco.repo.scripts.userhome.UserHomesLinkingUtil">
		<property name="serviceRegistry" ref="ServiceRegistry" />
	</bean>

	<!-- ByggReda -->
	<bean id="se.alingsas.alfresco.repo.utils.byggreda.ByggRedaUtil"
		class="se.alingsas.alfresco.repo.utils.byggreda.ByggRedaUtil">
		<property name="fileFolderService" ref="FileFolderService" />
		<property name="siteService" ref="SiteService" />
		<property name="nodeService" ref="NodeService" />
		<property name="versionService" ref="VersionService" />
		<property name="contentService" ref="ContentService" />
		<property name="checkOutCheckInService" ref="CheckOutCheckInService" />
		<property name="transactionService" ref="TransactionService" />
		<!-- SourceType can either be filesystem or repository, where repository is within the ByggReda site -->
		<property name="sourceType" value="filesystem" />
		<property name="siteName" value="byggreda" />
		<property name="destinationPath" value="Plan- och Byggarkiv" />
		<property name="logPath" value="Loggar" />
		<property name="outputPath" value="Output" />

		<property name="globalProperties">
			<ref bean="global-properties" />
		</property>

		<property name="sysAdminParams" ref="sysAdminParams" />
	</bean>

	<bean
		id="se.alingsas.alfresco.repo.forms.processor.TemplatedContentFilter"
		class="se.alingsas.alfresco.repo.forms.processor.TemplatedContentFilter"
		parent="baseFormFilter">
		<property name="filterRegistry" ref="typeFilterRegistry" />
		<property name="serviceRegistry" ref="ServiceRegistry" />
	</bean>
	
	<!-- ============ -->
    <!-- Override Site Service to prevent site creation for users other than Administrators and "PlatsinitiatÃ¶rer" -->
    <!-- ============ -->
    
    <bean id="SiteService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager"><ref bean="authenticationManager"/></property>
        <property name="accessDecisionManager"><ref bean="accessDecisionManager"/></property>
        <property name="afterInvocationManager"><ref bean="afterInvocationManager"/></property>
        <property name="objectDefinitionSource">
            <value>
               org.alfresco.service.cmr.site.SiteService.cleanSitePermissions=ACL_NODE.0.sys:base.ReadProperties
               org.alfresco.service.cmr.site.SiteService.createContainer=ACL_ALLOW,AFTER_ACL_NODE.sys:base.ReadProperties
               org.alfresco.service.cmr.site.SiteService.createSite=ACL_METHOD.ROLE_ADMINISTRATOR,ACL_METHOD.GROUP_PLATSINITIATORER
               org.alfresco.service.cmr.site.SiteService.deleteSite=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.findSites=ACL_ALLOW,AFTER_ACL_NODE.sys:base.ReadProperties
               org.alfresco.service.cmr.site.SiteService.getContainer=ACL_ALLOW,AFTER_ACL_NODE.sys:base.ReadProperties
               org.alfresco.service.cmr.site.SiteService.getMembersRole=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.getSite=ACL_ALLOW,AFTER_ACL_NODE.sys:base.ReadProperties
               org.alfresco.service.cmr.site.SiteService.getSiteGroup=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.getSiteRoleGroup=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.getSiteRoles=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.getSiteRoot=ACL_ALLOW,AFTER_ACL_NODE.sys:base.ReadProperties
               org.alfresco.service.cmr.site.SiteService.hasContainer=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.hasCreateSitePermissions=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.isMember=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.listMembers=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.listSites=ACL_ALLOW,AFTER_ACL_NODE.sys:base.ReadProperties
               org.alfresco.service.cmr.site.SiteService.removeMembership=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.setMembership=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.updateSite=ACL_ALLOW
               org.alfresco.service.cmr.site.SiteService.*=ACL_DENY
            </value>
        </property>
    </bean>
</beans>
